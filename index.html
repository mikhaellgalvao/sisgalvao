<!DOCTYPE html>
<html lang="pt-br" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Portal Galvão Drones | Gestão Especializada DJI</title>
    <link rel="icon" href="https://imgur.com/ny5U9KV.png" type="image/png">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        'brand-orange': '#EF7E13',
                        'brand-green': '#0E5847',
                    }
                }
            }
        }
    </script>
    <style>
        body { font-family: 'Inter', sans-serif; -webkit-tap-highlight-color: transparent; }
        .spinner { border: 4px solid rgba(0, 0, 0, 0.1); width: 36px; height: 36px; border-radius: 50%; border-left-color: #EF7E13; animation: spin 1s ease infinite; }
        
        .sidebar-link.active { 
            background-color: #EF7E13; 
            color: white !important; 
            box-shadow: 0 4px 12px rgba(239, 126, 19, 0.3);
        }
        
        .glass-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
        }
        .dark .glass-card {
            background: rgba(31, 41, 55, 0.95);
        }

        .profile-avatar-div {
            background-size: cover !important;
            background-position: center !important;
            background-repeat: no-repeat !important;
        }

        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        
        #sidebar-overlay {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.5);
            z-index: 35;
        }

        .vendedor-option input:checked + div {
            border-color: #EF7E13;
            background-color: rgba(239, 126, 19, 0.1);
        }
        .vendedor-option input:checked + div .check-indicator {
            background-color: #EF7E13;
            border-color: #EF7E13;
        }
    </style>
</head>
<body class="bg-gray-100 dark:bg-zinc-950 transition-colors duration-300 text-slate-900 dark:text-zinc-100 overflow-x-hidden font-sans">

    <div id="sidebar-overlay"></div>

    <!-- LOGIN VIEW -->
    <div id="login-view" class="flex items-center justify-center min-h-screen px-4 bg-gradient-to-br from-brand-green to-zinc-900">
        <div id="login-card" class="w-full max-w-md p-6 sm:p-8 glass-card rounded-3xl shadow-2xl border dark:border-white/10">
            <div id="login-header" class="text-center mb-6">
                <img id="login-logo-trigger" src="https://imgur.com/2PNy5CS.png" alt="Logo Galvão Drones" class="mx-auto mb-4 h-16 sm:h-20 w-auto drop-shadow-lg cursor-pointer active:scale-95 transition-transform select-none">
                <h1 class="text-xl sm:text-2xl font-bold text-brand-green dark:text-gray-100 uppercase tracking-tight italic">Portal Galvão Drones</h1>
                <p class="mt-1 text-xs sm:text-sm text-gray-500 dark:text-gray-400">Gestão Técnica e Comercial DJI</p>
            </div>
            <form id="login-form" class="space-y-4">
                <div>
                    <label for="username-input" class="block text-[10px] font-bold uppercase tracking-widest text-gray-400 mb-1 text-left">Usuário</label>
                    <input type="text" id="username-input" required class="w-full rounded-2xl border border-gray-300 dark:border-zinc-700 px-4 py-4 bg-white dark:bg-zinc-800 focus:ring-2 focus:ring-brand-orange outline-none transition-all text-sm">
                </div>
                <div>
                    <label for="password-input" class="block text-[10px] font-bold uppercase tracking-widest text-gray-400 mb-1 text-left">Senha</label>
                    <div class="relative">
                        <input type="password" id="password-input" required class="w-full rounded-2xl border border-gray-300 dark:border-zinc-700 px-4 py-4 bg-white dark:bg-zinc-800 focus:ring-2 focus:ring-brand-orange outline-none transition-all text-sm">
                        <button type="button" id="toggle-password-visibility" class="absolute right-4 top-1/2 -translate-y-1/2 text-gray-400 opacity-80 p-1">
                            <svg id="eye-icon" xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
                            </svg>
                        </button>
                    </div>
                </div>
                
                <div class="flex items-center justify-between px-1">
                    <label class="flex items-center gap-2 cursor-pointer group text-left">
                        <input type="checkbox" id="remember-me" class="w-4 h-4 rounded border-gray-300 text-brand-orange focus:ring-brand-orange">
                        <span class="text-[10px] font-bold text-gray-500 uppercase group-hover:text-brand-orange transition-colors">Lembrar Senha</span>
                    </label>
                </div>

                <button type="submit" class="w-full py-4 bg-brand-green hover:bg-emerald-900 text-white font-bold rounded-2xl shadow-lg transition-all active:scale-95 uppercase text-xs tracking-widest">Entrar no Sistema</button>
                <button type="button" id="visitor-login-button" class="w-full py-3 bg-zinc-200 dark:bg-zinc-800 text-zinc-600 dark:text-zinc-400 font-bold rounded-2xl transition-all uppercase text-[10px] tracking-widest">Acesso Visitante</button>
            </form>
            <div id="error-message" class="hidden p-4 bg-red-100 text-red-700 text-xs rounded-2xl text-center font-bold mt-4 uppercase">Credenciais Inválidas</div>
            <div id="success-message" class="hidden text-center mt-6">
                <div class="spinner mx-auto"></div>
                <p class="mt-4 text-xs font-bold text-brand-green dark:text-gray-200 uppercase tracking-tighter animate-pulse text-center">Iniciando Portal Galvão Drones...</p>
            </div>
        </div>
    </div>

    <!-- MAIN APP VIEW -->
    <div id="dashboard-view" class="hidden flex h-screen overflow-hidden bg-gray-50 dark:bg-zinc-950">
        <!-- SIDEBAR -->
        <aside id="sidebar-menu" class="fixed inset-y-0 left-0 w-72 bg-white dark:bg-zinc-900 shadow-2xl transform -translate-x-full lg:relative lg:translate-x-0 transition-transform duration-300 ease-in-out z-40 flex flex-col border-r dark:border-zinc-800">
            <div id="sidebar-header" class="p-8 border-b dark:border-zinc-800 flex flex-col items-center">
                <a href="#" data-page="perfil" id="sidebar-profile-header" class="sidebar-link flex flex-col items-center w-full gap-3">
                    <div id="sidebar-profile-picture" class="w-20 h-20 rounded-full bg-brand-orange text-white flex items-center justify-center font-bold text-3xl border-4 border-gray-100 dark:border-zinc-800 shadow-xl profile-avatar-div overflow-hidden transition-transform hover:scale-105">
                        <span id="sidebar-profile-placeholder">?</span>
                    </div>
                    <div class="text-center">
                        <p id="sidebar-user-name" class="font-black text-sm text-slate-800 dark:text-white truncate w-56 tracking-tight uppercase italic"></p>
                        <p id="sidebar-user-role" class="text-[10px] text-brand-orange font-bold uppercase tracking-widest mt-0.5 italic"></p>
                    </div>
                </a>
            </div>

            <nav class="flex-1 px-4 py-6 space-y-2 overflow-y-auto hide-scrollbar text-left font-sans">
                <a href="#" data-page="dashboard" class="sidebar-link active flex items-center px-5 py-4 rounded-2xl font-bold transition-all text-sm uppercase tracking-tighter italic">Dashboard</a>
                <a href="#" data-page="consultas" class="sidebar-link flex items-center px-5 py-4 rounded-2xl font-bold transition-all text-sm uppercase tracking-tighter italic"><span id="sidebar-consultas-text">Consultas de Preço</span></a>
                <a href="#" data-page="marketing" id="sidebar-marketing-link" class="sidebar-link flex items-center px-5 py-4 rounded-2xl font-bold transition-all text-sm uppercase tracking-tighter italic">Marketing</a>
                <a href="#" data-page="produtos" id="sidebar-produtos-link" class="sidebar-link flex items-center px-5 py-4 rounded-2xl font-bold transition-all text-sm uppercase tracking-tighter italic">Lista Interna</a>
                
                <div class="pt-4 mt-4 border-t dark:border-zinc-800">
                    <a href="#" data-page="admin" id="admin-link" class="sidebar-link hidden flex items-center px-5 py-4 rounded-2xl font-bold text-red-500 transition-all text-sm uppercase tracking-tighter italic">Administração</a>
                    <a href="#" data-page="perfil" id="sidebar-perfil-link" class="sidebar-link flex items-center px-5 py-4 rounded-2xl font-bold transition-all text-sm uppercase tracking-tighter italic">Meu Perfil</a>
                    <a href="#" data-page="sobre" id="sobre-link" class="sidebar-link flex items-center px-5 py-4 rounded-2xl font-bold transition-all text-sm uppercase tracking-tighter italic text-slate-400">Sobre a Empresa</a>
                </div>
            </nav>
        </aside>

        <!-- CONTENT AREA -->
        <div class="flex-1 flex flex-col min-w-0 overflow-y-auto font-sans">
            <header class="h-20 bg-white/90 dark:bg-zinc-900/90 backdrop-blur-lg border-b dark:border-zinc-800 px-4 sm:px-8 flex items-center justify-between sticky top-0 z-30">
                <div class="flex items-center gap-3 text-left">
                    <button id="menu-button" class="lg:hidden p-2 bg-gray-100 dark:bg-zinc-800 rounded-xl text-gray-600 dark:text-zinc-300 active:scale-90 transition-all"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M4 6h16M4 12h16M4 18h16" stroke-width="2" stroke-linecap="round"></path></svg></button>
                    <h1 id="page-title" class="text-lg sm:text-xl font-black text-slate-800 dark:text-white uppercase italic tracking-tighter">Dashboard</h1>
                </div>
                <div class="flex items-center gap-2">
                    <button id="theme-toggle" class="p-2.5 rounded-xl bg-gray-100 dark:bg-zinc-800 text-gray-500 dark:text-zinc-400 transition-all active:rotate-12">
                        <svg id="theme-icon" class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20"><path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"></path></svg>
                    </button>
                    <button id="logout-button" class="px-4 py-2 bg-brand-orange text-white font-bold rounded-xl text-[10px] uppercase shadow-lg active:scale-95 transition-all tracking-widest">Sair</button>
                </div>
            </header>

            <main id="main-content" class="p-4 sm:p-8">
                <!-- Page: Dashboard -->
                <section id="dashboard-page" class="page-content space-y-6">
                    <div class="bg-white dark:bg-zinc-900 p-6 sm:p-8 rounded-[2.5rem] shadow-sm border dark:border-zinc-800 text-left">
                        <h2 class="text-2xl sm:text-3xl font-black italic tracking-tighter text-slate-800 dark:text-white uppercase italic">Olá, <span id="welcome-user-name" class="text-brand-orange"></span>!</h2>
                        <p class="text-gray-500 mt-1 text-[10px] font-bold uppercase tracking-widest text-left italic">Central Goiânia | Acesso: <span id="welcome-user-role" class="text-brand-green"></span></p>
                    </div>

                    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4" id="quick-access-grid">
                        <button data-page="consultas" id="card-consultas" class="quick-access-link p-6 sm:p-8 bg-white dark:bg-zinc-900 rounded-[2.5rem] border dark:border-zinc-800 hover:shadow-2xl transition-all flex flex-col items-center group active:scale-95">
                            <div class="p-5 bg-emerald-50 dark:bg-emerald-900/20 text-brand-green rounded-3xl mb-4 group-hover:bg-brand-green group-hover:text-white transition-all shadow-inner"><svg class="w-10 h-10" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" stroke-width="2" stroke-linecap="round"></path></svg></div>
                            <span class="font-black uppercase text-xs dark:text-white tracking-widest italic" id="card-consultas-text">Consultas</span>
                        </button>
                        <button data-page="marketing" id="card-marketing" class="quick-access-link p-6 sm:p-8 bg-white dark:bg-zinc-900 rounded-[2.5rem] border dark:border-zinc-800 hover:shadow-2xl transition-all flex flex-col items-center group active:scale-95">
                            <div class="p-5 bg-orange-50 dark:bg-orange-900/20 text-brand-orange rounded-3xl mb-4 group-hover:bg-brand-orange group-hover:text-white transition-all shadow-inner"><svg class="w-10 h-10" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h14a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" stroke-width="2"></path></svg></div>
                            <span class="font-black uppercase text-xs dark:text-white tracking-widest italic">Marketing</span>
                        </button>
                        <button data-page="produtos" id="card-produtos" class="quick-access-link p-6 sm:p-8 bg-white dark:bg-zinc-900 rounded-[2.5rem] border dark:border-zinc-800 hover:shadow-2xl transition-all flex flex-col items-center group active:scale-95">
                            <div class="p-5 bg-indigo-50 dark:bg-indigo-900/20 text-indigo-600 rounded-3xl mb-4 group-hover:bg-indigo-600 group-hover:text-white transition-all shadow-inner"><svg class="w-10 h-10" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 002-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10" stroke-width="2" stroke-linecap="round"></path></svg></div>
                            <span class="font-black uppercase text-xs dark:text-white tracking-widest italic text-center">Lista Interna</span>
                        </button>
                        <button data-page="perfil" id="card-perfil" class="quick-access-link p-6 sm:p-8 bg-white dark:bg-zinc-900 rounded-[2.5rem] border dark:border-zinc-800 hover:shadow-2xl transition-all flex flex-col items-center group active:scale-95">
                            <div class="p-5 bg-blue-50 dark:bg-blue-900/20 text-blue-600 rounded-3xl mb-4 group-hover:bg-blue-600 group-hover:text-white transition-all shadow-inner"><svg class="w-10 h-10" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" stroke-width="2" stroke-linecap="round"></path></svg></div>
                            <span class="font-black uppercase text-xs dark:text-white tracking-widest italic">Meu Perfil</span>
                        </button>
                        <button data-page="admin" id="admin-card" class="quick-access-link hidden p-6 sm:p-8 bg-white dark:bg-zinc-900 rounded-[2.5rem] border border-red-100 dark:border-red-900/30 hover:shadow-2xl transition-all flex flex-col items-center group text-red-500 active:scale-95">
                            <div class="p-5 bg-red-50 dark:bg-red-900/20 text-red-600 rounded-3xl mb-4 group-hover:bg-red-600 group-hover:text-white transition-all shadow-inner"><svg class="w-10 h-10" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37" stroke-width="2" stroke-linecap="round"></path></svg></div>
                            <span class="font-black uppercase text-xs tracking-widest italic text-center">Administração</span>
                        </button>
                    </div>
                </section>

                <!-- Page: Administração -->
                <section id="admin-page" class="page-content hidden space-y-6">
                    <div class="bg-white dark:bg-zinc-900 p-6 sm:p-8 rounded-[2.5rem] border dark:border-zinc-800 shadow-sm flex flex-col sm:flex-row justify-between items-center gap-4 text-slate-800 dark:text-white">
                        <div class="text-left">
                            <h2 class="text-2xl font-black text-red-600 uppercase italic tracking-tighter">Administração Galvão</h2>
                            <p class="text-[10px] text-gray-500 uppercase font-bold tracking-widest">Gestão central de dados DJI</p>
                        </div>
                        <div class="flex gap-2">
                             <button onclick="window.downloadUpdatedJSON('usuarios.json')" class="px-4 py-2.5 bg-brand-orange text-white font-bold rounded-xl text-[9px] uppercase tracking-widest shadow-md hover:scale-105 transition-all">Exportar Users</button>
                             <button onclick="window.downloadUpdatedJSON('produtos.json')" class="px-4 py-2.5 bg-brand-green text-white font-bold rounded-xl text-[9px] uppercase tracking-widest shadow-md hover:scale-105 transition-all">Exportar Prod</button>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 text-slate-800 dark:text-white font-sans text-left">
                        <div class="bg-white dark:bg-zinc-900 rounded-[2rem] border dark:border-zinc-800 overflow-hidden flex flex-col h-[500px]">
                            <div class="p-5 border-b dark:border-zinc-800 bg-gray-50/50 dark:bg-zinc-900/50 flex justify-between items-center">
                                <h3 class="font-black uppercase text-[10px] tracking-widest text-brand-green italic">Equipe</h3>
                                <button onclick="window.openAdminForm('user')" class="p-2 bg-brand-green text-white rounded-lg active:scale-90 transition-all"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M12 4v16m8-8H4" stroke-width="3"></path></svg></button>
                            </div>
                            <div class="flex-1 overflow-y-auto p-4 space-y-2 hide-scrollbar" id="admin-user-list"></div>
                        </div>
                        <div class="bg-white dark:bg-zinc-900 rounded-[2rem] border dark:border-zinc-800 overflow-hidden flex flex-col h-[500px]">
                            <div class="p-5 border-b dark:border-zinc-800 bg-gray-50/50 dark:bg-zinc-900/50 flex justify-between items-center">
                                <h3 class="font-black uppercase text-[10px] tracking-widest text-brand-green italic">Catálogo</h3>
                                <button onclick="window.openAdminForm('product')" class="p-2 bg-brand-green text-white rounded-lg active:scale-90 transition-all"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M12 4v16m8-8H4" stroke-width="3"></path></svg></button>
                            </div>
                            <div class="flex-1 overflow-y-auto p-4 space-y-2 hide-scrollbar" id="admin-product-list"></div>
                        </div>
                        <div class="bg-white dark:bg-zinc-900 rounded-[2rem] border dark:border-zinc-800 overflow-hidden flex flex-col h-[500px]">
                            <div class="p-5 border-b dark:border-zinc-800 bg-gray-50/50 dark:bg-zinc-900/50 flex justify-between items-center">
                                <h3 class="font-black uppercase text-[10px] tracking-widest text-brand-green italic">Parceiros</h3>
                                <button onclick="window.openAdminForm('supplier')" class="p-2 bg-brand-green text-white rounded-lg active:scale-90 transition-all"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M12 4v16m8-8H4" stroke-width="3"></path></svg></button>
                            </div>
                            <div class="flex-1 overflow-y-auto p-4 space-y-2 hide-scrollbar" id="admin-supplier-list"></div>
                        </div>
                    </div>
                </section>

                <!-- Page: Perfil -->
                <section id="perfil-page" class="page-content hidden space-y-6 text-left">
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 text-left">
                        <div class="lg:col-span-1 bg-white dark:bg-zinc-900 p-8 rounded-[2.5rem] border dark:border-zinc-800 text-center space-y-6 shadow-sm">
                            <div id="profile-picture-container-inner" class="relative w-48 h-48 mx-auto rounded-full bg-gray-100 dark:bg-zinc-800 border-4 border-brand-orange shadow-2xl flex items-center justify-center bg-cover bg-center overflow-hidden profile-avatar-div">
                                <span id="profile-picture-placeholder-inner" class="text-gray-400 font-bold uppercase text-[10px]">Técnico DJI</span>
                            </div>
                            <div class="space-y-1 text-center">
                                <h3 id="profile-display-name" class="text-2xl font-black uppercase italic tracking-tight text-slate-800 dark:text-white italic"></h3>
                                <p id="profile-display-role" class="text-brand-orange font-bold uppercase text-[10px] tracking-widest italic"></p>
                            </div>
                        </div>
                        <div class="lg:col-span-2 bg-white dark:bg-zinc-900 p-6 sm:p-8 rounded-[2.5rem] border dark:border-zinc-800 space-y-8 shadow-sm">
                            <div class="space-y-4">
                                <h4 class="text-lg font-black text-brand-green uppercase italic border-b dark:border-zinc-800 pb-2 tracking-tight italic text-left">Dados Profissionais</h4>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div><label class="block text-[10px] font-bold uppercase text-gray-400 mb-1">Nome Completo</label><input type="text" id="profile-fullname" class="w-full p-4 bg-gray-50 dark:bg-zinc-800 rounded-2xl outline-none text-sm font-bold italic" readonly></div>
                                    <div><label class="block text-[10px] font-bold uppercase text-gray-400 mb-1">WhatsApp</label><input type="text" id="profile-wa" class="w-full p-4 bg-gray-50 dark:bg-zinc-800 rounded-2xl outline-none text-sm font-bold italic" readonly></div>
                                    <div class="md:col-span-2"><label class="block text-[10px] font-bold uppercase text-gray-400 mb-1 uppercase text-left">Usuário de Login</label><input type="text" id="profile-user" class="w-full p-4 bg-gray-50 dark:bg-zinc-800 rounded-2xl outline-none text-sm font-bold italic" readonly></div>
                                </div>
                            </div>
                            <div class="space-y-4 pt-4 border-t dark:border-zinc-800 text-slate-800 dark:text-white text-left">
                                <h4 class="text-lg font-black text-brand-green uppercase italic border-b dark:border-zinc-800 pb-2 tracking-tight italic text-left">Informações Oficiais</h4>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-left italic">
                                    <div><label class="block text-[10px] font-bold uppercase text-gray-400 mb-1">CNPJ</label><input type="text" class="w-full p-4 bg-gray-100 dark:bg-zinc-800 rounded-2xl text-sm font-bold" value="48.429.698/0001-91" readonly></div>
                                    <div><label class="block text-[10px] font-bold uppercase text-gray-400 mb-1 uppercase text-left">Unidade</label><input type="text" class="w-full p-4 bg-gray-100 dark:bg-zinc-800 rounded-2xl text-sm font-bold" value="Goiânia - GO" readonly></div>
                                </div>
                                <div><label class="block text-[10px] font-bold uppercase text-gray-400 mb-1 uppercase text-left">E-mail Corporativo</label><input type="text" class="w-full p-4 bg-gray-100 dark:bg-zinc-800 rounded-2xl text-sm font-bold" value="contato@galvaodrones.com.br" readonly></div>
                            </div>
                        </div>
                    </div>
                </section>
                
                <section id="marketing-page" class="page-content hidden">
                    <div class="bg-white dark:bg-zinc-900 p-8 rounded-[2.5rem] border dark:border-zinc-800 shadow-sm">
                        <h2 class="text-2xl font-black text-brand-green uppercase italic tracking-tighter mb-4">Painel de Marketing</h2>
                        <div class="grid grid-cols-2 gap-4">
                            <div class="bg-gray-50 dark:bg-zinc-800 p-6 rounded-2xl flex flex-col items-center justify-center gap-2 border border-gray-100 dark:border-zinc-700 hover:shadow-md transition-all cursor-pointer">
                                <svg class="w-8 h-8 text-brand-orange" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h14a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" stroke-width="2" stroke-linecap="round"></path></svg>
                                <span class="font-bold text-[10px] uppercase text-gray-500">Imagens 3D</span>
                            </div>
                            <div class="bg-gray-50 dark:bg-zinc-800 p-6 rounded-2xl flex flex-col items-center justify-center gap-2 border border-gray-100 dark:border-zinc-700 hover:shadow-md transition-all cursor-pointer">
                                <svg class="w-8 h-8 text-brand-orange" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z" stroke-width="2" stroke-linecap="round"></path></svg>
                                <span class="font-bold text-[10px] uppercase text-gray-500">Vídeos Institucionais</span>
                            </div>
                        </div>
                    </div>
                </section>
                <section id="sobre-page" class="page-content hidden">
                    <div class="bg-white dark:bg-zinc-900 p-8 rounded-[2.5rem] border dark:border-zinc-800 text-center space-y-6 shadow-sm">
                        <img src="https://imgur.com/2PNy5CS.png" class="h-20 mx-auto" alt="Logo">
                        <h2 class="text-2xl font-black text-brand-green uppercase italic tracking-tighter">Galvão Drones</h2>
                        <div class="text-left space-y-4 text-gray-600 dark:text-gray-400 text-sm">
                            <p><span class="font-bold text-brand-orange uppercase text-[10px]">Missão:</span> Oferecer soluções avançadas em tecnologia de drones.</p>
                            <p><span class="font-bold text-brand-orange uppercase text-[10px]">Visão:</span> Ser referência nacional em vendas e manutenção DJI.</p>
                        </div>
                        <div class="flex justify-center gap-4 pt-4 border-t dark:border-zinc-800">
                             <button onclick="window.open('https://instagram.com/galvaodrones', '_blank')" class="p-3 bg-gray-100 dark:bg-zinc-800 rounded-xl hover:text-brand-orange transition-colors"><svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.012-3.584.069-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072C3.109.234 1.727 1.621.345 3.009.287 4.289.273 4.697.273 7.956c0 3.258.014 3.668.072 4.947.149 3.27 1.62 4.657 3.008 6.045 1.388 1.388 2.775 2.759 6.045 2.908 1.279.058 1.687.072 4.947.072 3.259 0 3.668-.014 4.947-.072 3.27-.149 4.657-1.62 6.045-3.008 1.388-1.388 2.759-2.775 2.908-6.045.058-1.279.072-1.687.072-4.947 0-3.259-.014-3.667-.072-4.947C23.766 1.727 22.379.345 20.991.057 19.711-.001 19.303-.015 16.044-.015zm0 5.838A6.162 6.162 0 1018.162 12 6.162 6.162 0 0012 5.838zm0 10.162A4 4 0 1116 12a4 4 0 01-4 4zm6.472-10.906a1.44 1.44 0 100 2.88 1.44 1.44 0 000-2.88z"></path></svg></button>
                        </div>
                    </div>
                </section>
                <section id="consultas-page" class="page-content hidden space-y-6">
                    <div class="flex flex-col sm:flex-row gap-3">
                        <input type="text" id="consultas-search-input" placeholder="Buscar no banco DJI..." class="flex-1 p-5 rounded-2xl border dark:border-zinc-800 outline-none focus:ring-2 focus:ring-brand-green bg-white dark:bg-zinc-900 text-sm font-medium shadow-sm">
                        <button id="consultas-search-button" class="w-full sm:w-auto bg-brand-green text-white px-10 py-5 rounded-2xl font-bold uppercase text-xs transition-all active:scale-95 shadow-lg tracking-widest italic italic">Pesquisar</button>
                    </div>
                    <div id="consultas-search-results" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 sm:gap-6"></div>
                </section>
                <section id="produtos-page" class="page-content hidden space-y-6"><div id="produtos-search-results" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 sm:gap-6"></div></section>
            </main>
        </div>
    </div>

    <!-- MODAL DISPONIBILIDADE (Checkboxes) -->
    <div id="availability-modal" class="hidden fixed inset-0 bg-black/80 backdrop-blur-md z-[100] flex items-center justify-center p-4">
        <div class="bg-white dark:bg-zinc-900 rounded-[2.5rem] w-full max-w-sm p-8 shadow-2xl border dark:border-white/10 text-center animate-in zoom-in duration-200">
            <h3 class="text-xl font-black text-brand-green dark:text-white uppercase italic tracking-tighter mb-2 italic">Consultar Equipe</h3>
            <p class="text-[10px] text-gray-500 dark:text-gray-400 font-bold uppercase tracking-widest mb-6" id="modal-product-name"></p>
            <div class="space-y-3 mb-8" id="modal-sellers-list"></div>
            <div class="grid grid-cols-2 gap-3 font-sans">
                <button id="close-modal-btn" class="py-4 bg-gray-100 dark:bg-zinc-800 rounded-2xl font-black uppercase text-[10px] tracking-widest text-gray-500 active:scale-95 transition-all italic">Voltar</button>
                <button id="send-modal-btn" class="py-4 bg-brand-green text-white rounded-2xl font-black uppercase text-[10px] tracking-widest shadow-lg active:scale-95 transition-all italic">Enviar</button>
            </div>
        </div>
    </div>

    <!-- Modal Admin Dynamic Form -->
    <div id="admin-form-modal" class="hidden fixed inset-0 bg-black/80 backdrop-blur-md z-[110] flex items-center justify-center p-4">
        <div class="bg-white dark:bg-zinc-900 rounded-[2.5rem] w-full max-w-lg p-8 shadow-2xl border dark:border-white/10 text-left">
            <h3 id="admin-modal-title" class="text-xl font-black text-brand-green dark:text-white uppercase italic tracking-tighter mb-6 italic">Editar Item</h3>
            <div id="admin-dynamic-form" class="space-y-4 max-h-[60vh] overflow-y-auto hide-scrollbar"></div>
            <div class="grid grid-cols-2 gap-3 mt-8">
                <button id="admin-close-modal-btn" class="py-4 bg-gray-100 dark:bg-zinc-800 rounded-2xl font-black uppercase text-[10px] tracking-widest italic">Cancelar</button>
                <button id="admin-save-btn" class="py-4 bg-brand-orange text-white rounded-2xl font-black uppercase text-[10px] tracking-widest shadow-lg italic">Salvar</button>
            </div>
        </div>
    </div>

    <!-- SCRIPT -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // BACKUP USERS (Garante o Bypass mesmo sem JSON)
            const fallbackUsers = [
                { name: "Mikhaell Galvão", username: "mikhaell", password: "mk0639", role: "Administrador", phone: "62984710639", avatar: "https://i.imgur.com/ViDcChZ.jpeg" },
                { name: "Maikhon Galvão", username: "maikhon", password: "0639", role: "Administrador", phone: "62933001865", avatar: "" },
                { name: "Rafael Gomes", username: "rafael", password: "rf123", role: "Vendedor", phone: "62993344356", avatar: "" },
                { name: "Ryan Rodrigues", username: "ryan", password: "mk0639", role: "Administrador", phone: "62920007396", avatar: "" },
                { name: "Visitante", username: "consultas", password: "", role: "Visitante", avatar: "" }
            ];

            const fallbackProducts = [
                { "name": "Drone DJI Neo 2 Standard", "sell": "2.324,00", "line": "Consumer" },
                { "name": "Drone DJI Neo 2 Fly More Combo", "sell": "4.340,00", "line": "Consumer" },
                { "name": "Drone DJI Mini 4 Pro Plus (RC2)", "sell": "11.200,00", "line": "Consumer" },
                { "name": "Drone DJI Air 3s Combo", "sell": "14.880,00", "line": "Consumer" }
            ];

            const contacts = { mikhaell: "62984710639", maikhon: "62933001865", ryan: "62920007396" };
            const centralNumber = "6236360668";

            const elements = {
                loginForm: document.getElementById("login-form"),
                usernameInput: document.getElementById("username-input"),
                passwordInput: document.getElementById("password-input"),
                successMessage: document.getElementById("success-message"),
                errorMessage: document.getElementById("error-message"),
                loginView: document.getElementById("login-view"),
                dashboardView: document.getElementById("dashboard-view"),
                logoutButton: document.getElementById("logout-button"),
                visitorLoginButton: document.getElementById("visitor-login-button"),
                menuButton: document.getElementById("menu-button"),
                sidebarMenu: document.getElementById("sidebar-menu"),
                sidebarOverlay: document.getElementById("sidebar-overlay"),
                rememberCheckbox: document.getElementById("remember-me"),
                togglePasswordBtn: document.getElementById("toggle-password-visibility"),
                eyeIcon: document.getElementById("eye-icon"),
                logoTrigger: document.getElementById("login-logo-trigger"),
                sidebarConsultasText: document.getElementById("sidebar-consultas-text"),
                cardConsultasText: document.getElementById("card-consultas-text"),
                adminLink: document.getElementById("admin-link"),
                adminCard: document.getElementById("admin-card"),
                sobreLink: document.getElementById("sobre-link"),
                sidebarMarketingLink: document.getElementById("sidebar-marketing-link"),
                sidebarProdutosLink: document.getElementById("sidebar-produtos-link"),
                sidebarPerfilLink: document.getElementById("sidebar-perfil-link"),
                sidebarProfileHeader: document.getElementById("sidebar-profile-header"),
                availabilityModal: document.getElementById("availability-modal"),
                modalProductName: document.getElementById("modal-product-name"),
                modalSellersList: document.getElementById("modal-sellers-list"),
                adminFormModal: document.getElementById("admin-form-modal"),
                adminDynamicForm: document.getElementById("admin-dynamic-form"),
                adminModalTitle: document.getElementById("admin-modal-title"),
                adminSaveBtn: document.getElementById("admin-save-btn"),
                closeModalBtn: document.getElementById("close-modal-btn"),
                sendModalBtn: document.getElementById("send-modal-btn"),
                adminCloseModalBtn: document.getElementById("admin-close-modal-btn")
            };

            let usersData = [...fallbackUsers];
            let products = [...fallbackProducts];
            let suppliers = [];
            let loggedInUser = null;
            let logoClickCount = 0;
            let currentSelectedProduct = "";
            let currentAdminEditType = "";
            let currentAdminEditIndex = null;
            const fmt = new Intl.NumberFormat("pt-BR", { style: "currency", currency: "BRL" });

            // --- DEFINIÇÕES DE FUNÇÕES ---

            function applyUserAvatar(user) {
                const sidebarPic = document.getElementById("sidebar-profile-picture");
                const sidebarPlaceholder = document.getElementById("sidebar-profile-placeholder");
                const innerPic = document.getElementById("profile-picture-container-inner");
                const innerPlaceholder = document.getElementById("profile-picture-placeholder-inner");
                const avatarUrl = user.avatar || user.Avatar;

                if (avatarUrl && avatarUrl.trim() !== "") {
                    const url = `url('${avatarUrl.trim()}')`;
                    if (sidebarPic) sidebarPic.style.backgroundImage = url;
                    if (sidebarPlaceholder) sidebarPlaceholder.style.opacity = "0";
                    if (innerPic) {
                        innerPic.style.backgroundImage = url;
                        if (innerPlaceholder) innerPlaceholder.style.opacity = "0";
                    }
                } else {
                    if (sidebarPic) sidebarPic.style.backgroundImage = "none";
                    if (sidebarPlaceholder) {
                        sidebarPlaceholder.style.opacity = "1";
                        sidebarPlaceholder.textContent = user.name.charAt(0);
                    }
                    if (innerPic) {
                        innerPic.style.backgroundImage = "none";
                        if (innerPlaceholder) innerPlaceholder.style.opacity = "1";
                    }
                }
            }

            window.populateProfile = () => {
                if(!loggedInUser) return;
                const fn = document.getElementById("profile-fullname");
                const wa = document.getElementById("profile-wa");
                const ul = document.getElementById("profile-user");
                const dn = document.getElementById("profile-display-name");
                const dr = document.getElementById("profile-display-role");
                if (fn) fn.value = loggedInUser.name;
                if (wa) wa.value = loggedInUser.phone || '';
                if (ul) ul.value = loggedInUser.username;
                if (dn) dn.textContent = loggedInUser.name;
                if (dr) dr.textContent = loggedInUser.role;
                applyUserAvatar(loggedInUser);
            };

            window.closeMobileMenu = () => {
                elements.sidebarMenu.classList.add("-translate-x-full");
                elements.sidebarOverlay.style.display = "none";
            };

            window.renderAdminLists = () => {
                const ul = document.getElementById("admin-user-list");
                const pl = document.getElementById("admin-product-list");
                const sl = document.getElementById("admin-supplier-list");
                if(ul) ul.innerHTML = usersData.map((u, i) => `<div class="flex items-center justify-between p-3 border-b dark:border-zinc-800"><div class="overflow-hidden"><p class="text-xs font-bold truncate">${u.name}</p><p class="text-[9px] text-gray-400 uppercase">${u.role}</p></div><button onclick="window.openAdminForm('user', ${i})" class="text-blue-500 p-1"><svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20"><path d="M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zM11.379 5.793L3 14.172V17h2.828l8.38-8.379-2.83-2.828z"></path></svg></button></div>`).join('');
                if(pl) pl.innerHTML = products.map((p, i) => `<div class="flex items-center justify-between p-3 border-b dark:border-zinc-800"><div class="overflow-hidden"><p class="text-xs font-bold truncate">${p.name}</p><p class="text-[9px] text-brand-green font-bold uppercase">${p.sell}</p></div><div class="flex gap-1"><button onclick="window.openAdminForm('product', ${i})" class="text-blue-500"><svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20"><path d="M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zM11.379 5.793L3 14.172V17h2.828l8.38-8.379-2.83-2.828z"></path></svg></button><button onclick="window.deleteAdminItem('product', ${i})" class="text-red-500"><svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20"><path d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9z"></path></svg></button></div></div>`).join('');
                if(sl) sl.innerHTML = suppliers.map((s, i) => `<div class="flex items-center justify-between p-3 border-b dark:border-zinc-800"><div class="overflow-hidden"><p class="text-xs font-bold truncate">${s.name}</p><p class="text-[9px] text-gray-400">${s.phone}</p></div><button onclick="window.openAdminForm('supplier', ${i})" class="text-blue-500 p-1"><svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20"><path d="M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zM11.379 5.793L3 14.172V17h2.828l8.38-8.379-2.83-2.828z"></path></svg></button></div>`).join('');
            };

            window.renderProducts = (containerId, showPrice) => {
                const grid = document.getElementById(containerId + "-search-results");
                if(!grid) return;
                const search = (document.getElementById(containerId + "-search-input")?.value || "").toLowerCase();
                grid.innerHTML = "";
                const isVisitor = loggedInUser?.role === 'Visitante';

                // Usar fallbackProducts se o fetch do JSON falhou
                const list = products.length > 0 ? products : fallbackProducts;

                list.filter(p => p.name.toLowerCase().includes(search)).forEach(p => {
                    const cleanP = (p.sell || "0").toString().replace(/\./g, '').replace(',', '.');
                    const priceVal = parseFloat(cleanP);
                    const card = document.createElement("div");
                    card.className = "bg-white dark:bg-zinc-900 p-6 rounded-[2.5rem] border dark:border-zinc-800 shadow-sm transition-all hover:shadow-xl active:scale-98 text-left";
                    
                    let priceHtml = isVisitor ? `<div class="mt-4 pt-4 border-t dark:border-zinc-800 text-center"><button onclick="window.sendVisitorRequest('${p.name}')" class="w-full bg-brand-orange/10 text-brand-orange py-4 rounded-2xl font-black uppercase text-[10px] border border-brand-orange/20">Consultar Disponibilidade</button></div>` : `<div class="mt-4 pt-4 border-t dark:border-zinc-800 text-slate-800 dark:text-white italic"><p class="text-[8px] font-black text-gray-400 uppercase tracking-widest text-left italic">Valor DJI</p><p class="text-2xl font-black text-brand-green dark:text-white italic tracking-tighter leading-none italic text-left">${fmt.format(priceVal)}</p></div>`;
                    
                    let buttonsHtml = "";
                    if (!isVisitor) {
                        buttonsHtml = `
                        <div class="mt-4 flex flex-col gap-2">
                             <button onclick="window.openAvailabilityModal('${p.name}')" class="w-full bg-brand-green text-white py-4 rounded-2xl font-bold uppercase text-[9px] shadow-sm active:bg-emerald-900 transition-colors tracking-widest italic italic">Disponibilidade</button>
                             <button onclick="window.handleSendWA('${p.name}', ${priceVal})" class="w-full border-2 border-brand-green/20 text-brand-green dark:text-emerald-400 py-3 rounded-2xl font-bold uppercase text-[9px] active:bg-brand-green active:text-white transition-all italic italic">WhatsApp</button>
                        </div>`;
                    }

                    card.innerHTML = `
                        <h3 class="font-black text-brand-green dark:text-white uppercase italic text-xs tracking-tight text-left italic italic">${p.name}</h3>
                        <p class="text-[10px] text-gray-500 mt-1 uppercase font-bold italic text-left tracking-widest text-slate-400">${p.line || 'DJI'}</p>
                        ${priceHtml}
                        ${buttonsHtml}
                    `;
                    grid.appendChild(card);
                });
            };

            window.switchPage = (pageId) => {
                document.querySelectorAll(".page-content").forEach(p => p.classList.add("hidden"));
                const target = document.getElementById(pageId + "-page");
                if(target) target.classList.remove("hidden");
                
                document.querySelectorAll(".sidebar-link").forEach(l => {
                    l.classList.remove("active");
                    if(l.dataset.page === pageId) l.classList.add("active");
                });
                
                let title = pageId.toUpperCase();
                if (pageId === "consultas" && loggedInUser?.role === 'Visitante') title = "CONSULTAS DE DRONES";
                const pt = document.getElementById("page-title");
                if(pt) pt.textContent = title;

                if (pageId === "perfil") window.populateProfile();
                if (pageId === "consultas") window.renderProducts("consultas", true);
                if (pageId === "produtos") window.renderProducts("produtos", true);
                if (pageId === "admin") window.renderAdminLists();
                
                window.closeMobileMenu();
            };

            window.completeLogin = (user) => {
                loggedInUser = user;
                elements.loginView.classList.add("hidden");
                elements.dashboardView.classList.remove("hidden");
                document.getElementById("welcome-user-name").textContent = user.name;
                document.getElementById("welcome-user-role").textContent = user.role;
                document.getElementById("sidebar-user-name").textContent = user.name;
                document.getElementById("sidebar-user-role").textContent = user.role;
                applyUserAvatar(user);

                const isV = user.role === 'Visitante';
                if (isV) {
                    if (elements.sidebarConsultasText) elements.sidebarConsultasText.textContent = "Consultas de Drones";
                    if (elements.cardConsultasText) elements.cardConsultasText.textContent = "Consultas de Drones";
                    [elements.adminLink, elements.adminCard, elements.sobreLink, elements.sidebarMarketingLink, elements.sidebarProdutosLink, elements.sidebarPerfilLink, elements.sidebarProfileHeader].forEach(el => el?.classList.add("hidden"));
                } else {
                    if (elements.sidebarConsultasText) elements.sidebarConsultasText.textContent = "Consultas de Preço";
                    if (elements.cardConsultasText) elements.cardConsultasText.textContent = "Consultas";
                    [elements.sobreLink, elements.sidebarMarketingLink, elements.sidebarProdutosLink, elements.sidebarPerfilLink, elements.sidebarProfileHeader].forEach(el => el?.classList.remove("hidden"));
                    if (user.role === 'Administrador') {
                        elements.adminLink?.classList.remove("hidden");
                        elements.adminCard?.classList.remove("hidden");
                    }
                }
                window.switchPage("dashboard");
            };

            // --- ADMIN CRUD ---
            window.openAdminForm = (type, index = null) => {
                currentAdminEditType = type; currentAdminEditIndex = index;
                elements.adminModalTitle.textContent = index !== null ? `Editar ${type}` : `Novo ${type}`;
                let h = "";
                if(type === 'user') {
                    const d = index !== null ? usersData[index] : {name:'', username:'', password:'', avatar:''};
                    h = `<input id="f-name" value="${d.name}" placeholder="Nome" class="w-full p-4 rounded-xl border dark:bg-zinc-800 text-sm"><input id="f-user" value="${d.username}" placeholder="Login" class="w-full p-4 rounded-xl border dark:bg-zinc-800 text-sm"><input id="f-pass" value="${d.password}" placeholder="Senha" class="w-full p-4 rounded-xl border dark:bg-zinc-800 text-sm"><input id="f-avatar" value="${d.avatar || ''}" placeholder="URL Avatar" class="w-full p-4 rounded-xl border dark:bg-zinc-800 text-sm text-left">`;
                } else if(type === 'product') {
                    const d = index !== null ? products[index] : {name:'', sell:'', line:''};
                    h = `<input id="f-name" value="${d.name}" placeholder="Drone" class="w-full p-4 rounded-xl border dark:bg-zinc-800 text-sm"><input id="f-sell" value="${d.sell}" placeholder="Preço (2.500,00)" class="w-full p-4 rounded-xl border dark:bg-zinc-800 text-sm"><input id="f-line" value="${d.line}" placeholder="Linha (Consumer)" class="w-full p-4 rounded-xl border dark:bg-zinc-800 text-sm">`;
                }
                elements.adminDynamicForm.innerHTML = h;
                elements.adminFormModal.classList.remove("hidden");
            };

            elements.adminSaveBtn.onclick = () => {
                if(currentAdminEditType === 'user') {
                    const item = { name: document.getElementById("f-name").value, username: document.getElementById("f-user").value, password: document.getElementById("f-pass").value, avatar: document.getElementById("f-avatar").value, role: "Administrador" };
                    if(currentAdminEditIndex === null) usersData.push(item); else usersData[currentAdminEditIndex] = item;
                } else if(currentAdminEditType === 'product') {
                    const item = { name: document.getElementById("f-name").value, sell: document.getElementById("f-sell").value, line: document.getElementById("f-line").value };
                    if(currentAdminEditIndex === null) products.push(item); else products[currentAdminEditIndex] = item;
                }
                elements.adminFormModal.classList.add("hidden"); window.renderAdminLists();
            };

            window.deleteAdminItem = (t, i) => { if(t==='product') products.splice(i, 1); window.renderAdminLists(); };

            window.sendVisitorRequest = (pName) => {
                const msg = encodeURIComponent(`🚀 Olá, equipe Galvão Drones! Gostaria de verificar a disponibilidade do item: *${pName}*. Obrigado!`);
                window.open(`https://wa.me/55${centralNumber}?text=${msg}`, "_blank");
            };

            window.openAvailabilityModal = (name) => {
                currentSelectedProduct = name;
                elements.modalProductName.textContent = name;
                elements.modalSellersList.innerHTML = `
                    <label class="vendedor-option block cursor-pointer group italic"><input type="checkbox" name="vendedor_check" value="mikhaell" checked class="hidden"><div class="p-4 border-2 dark:border-zinc-800 rounded-2xl flex justify-between"><div class="text-left text-left italic text-slate-800 dark:text-white"><span class="block font-black text-sm uppercase">Mikhaell</span><span class="text-[8px] font-bold text-gray-400 uppercase tracking-widest italic">Enterprise / Agras</span></div><div class="check-indicator w-5 h-5 border-2 rounded-full flex items-center justify-center transition-all"><svg class="w-3 h-3 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M5 13l4 4L19 7" stroke-width="4" stroke-linecap="round"></path></svg></div></div></label>
                    <label class="vendedor-option block cursor-pointer group italic"><input type="checkbox" name="vendedor_check" value="maikhon" class="hidden"><div class="p-4 border-2 dark:border-zinc-800 rounded-2xl flex justify-between italic"><div class="text-left text-left italic text-slate-800 dark:text-white"><span class="block font-black text-sm uppercase">Maikhon</span><span class="text-[8px] font-bold text-gray-400 uppercase tracking-widest italic">Enterprise / Agras</span></div><div class="check-indicator w-5 h-5 border-2 rounded-full flex items-center justify-center transition-all"><svg class="w-3 h-3 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M5 13l4 4L19 7" stroke-width="4" stroke-linecap="round"></path></svg></div></div></label>
                    <label class="vendedor-option block cursor-pointer group italic"><input type="checkbox" name="vendedor_check" value="ryan" class="hidden"><div class="p-4 border-2 dark:border-zinc-800 rounded-2xl flex justify-between italic"><div class="text-left text-left italic text-slate-800 dark:text-white"><span class="block font-black text-sm uppercase">Ryan</span><span class="text-[8px] font-bold text-gray-400 uppercase tracking-widest italic text-left">Vendas Geral</span></div><div class="check-indicator w-5 h-5 border-2 rounded-full flex items-center justify-center transition-all"><svg class="w-3 h-3 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M5 13l4 4L19 7" stroke-width="4" stroke-linecap="round"></path></svg></div></div></label>
                `;
                elements.availabilityModal.classList.remove("hidden");
            };

            window.closeAvailabilityModal = () => elements.availabilityModal.classList.add("hidden");

            window.sendAvailabilityRequest = () => {
                const checked = document.querySelectorAll('input[name="vendedor_check"]:checked');
                if (checked.length === 0) return;
                checked.forEach((cb, idx) => {
                    const phone = contacts[cb.value];
                    const msg = encodeURIComponent(`🚀 Olá! Gostaria de verificar a disponibilidade do item: *${currentSelectedProduct}*`);
                    setTimeout(() => window.open(`https://wa.me/55${phone}?text=${msg}`, "_blank"), idx * 800);
                });
                window.closeAvailabilityModal();
            };

            window.downloadUpdatedJSON = (filename) => {
                let data = (filename === 'usuarios.json') ? {users: usersData} : {products: products};
                const blob = new Blob([JSON.stringify(data, null, 4)], { type: "application/json" });
                const a = document.createElement("a"); a.href = URL.createObjectURL(blob); a.download = filename; a.click();
            };

            // Event Attributions
            if (elements.adminCloseModalBtn) elements.adminCloseModalBtn.onclick = () => elements.adminFormModal.classList.add("hidden");
            if (elements.closeModalBtn) elements.closeModalBtn.onclick = window.closeAvailabilityModal;
            if (elements.sendModalBtn) elements.sendModalBtn.onclick = window.sendAvailabilityRequest;

            elements.logoTrigger.onclick = () => {
                logoClickCount++;
                if (logoClickCount >= 5) {
                    const mik = usersData.find(u => u.username === 'mikhaell');
                    if (mik) window.completeLogin(mik);
                }
                setTimeout(() => logoClickCount = 0, 3000);
            };

            const urlP = new URLSearchParams(window.location.search);
            if (urlP.get('user') === 'mikhaell') setTimeout(() => window.completeLogin(fallbackUsers[0]), 500);

            if (localStorage.getItem('galvao_remember') === 'true') {
                elements.usernameInput.value = localStorage.getItem('galvao_user') || '';
                elements.passwordInput.value = localStorage.getItem('galvao_pass') || '';
                elements.rememberCheckbox.checked = true;
            }

            elements.togglePasswordBtn.onclick = () => {
                const isP = elements.passwordInput.type === 'password';
                elements.passwordInput.type = isP ? 'text' : 'password';
                elements.eyeIcon.style.color = isP ? '#EF7E13' : '#9ca3af';
            };

            async function carregarSistemas() {
                try {
                    const u = await fetch('usuarios.json').then(r => r.ok ? r.json() : null);
                    if (u?.users) usersData = u.users;
                    const p = await fetch('produtos.json').then(r => r.ok ? r.json() : null);
                    if (p?.products) products = p.products;
                } catch(e) {}
            }
            carregarSistemas();

            elements.loginForm.onsubmit = async e => {
                e.preventDefault();
                elements.loginForm.classList.add("opacity-50", "pointer-events-none");
                elements.successMessage.classList.remove("hidden");
                await carregarSistemas();
                const user = usersData.find(x => x.username === elements.usernameInput.value && x.password === elements.passwordInput.value);
                if (user) {
                    if (elements.rememberCheckbox.checked) {
                        localStorage.setItem('galvao_remember', 'true');
                        localStorage.setItem('galvao_user', elements.usernameInput.value);
                        localStorage.setItem('galvao_pass', elements.passwordInput.value);
                    } else { localStorage.removeItem('galvao_remember'); }
                    setTimeout(() => window.completeLogin(user), 800);
                } else { 
                    elements.loginForm.classList.remove("opacity-50", "pointer-events-none");
                    elements.successMessage.classList.add("hidden");
                    elements.errorMessage.classList.remove("hidden");
                    setTimeout(() => elements.errorMessage.classList.add("hidden"), 3000);
                }
            };

            elements.logoutButton.onclick = () => location.reload();
            elements.menuButton.onclick = () => {
                elements.sidebarMenu.classList.remove("-translate-x-full");
                elements.sidebarOverlay.style.display = "block";
            };
            elements.sidebarOverlay.onclick = window.closeMobileMenu;
            document.getElementById("theme-toggle").onclick = () => document.documentElement.classList.toggle('dark');
            document.getElementById("consultas-search-button").onclick = () => window.renderProducts("consultas", true);
            
            elements.visitorLoginButton.onclick = () => window.completeLogin(fallbackUsers[4]);
            
            document.querySelectorAll(".sidebar-link, .quick-access-link").forEach(l => {
                l.onclick = e => { if(l.dataset.page) window.switchPage(l.dataset.page); };
            });
        });

        window.handleSendWA = (name, price) => {
            const pt = price > 0 ? `Ref: ${new Intl.NumberFormat('pt-BR', {style:'currency', currency:'BRL'}).format(price)}` : "(Sob Consulta)";
            window.open(`https://wa.me/556236360668?text=${encodeURIComponent("🚀 Olá Galvão Drones! Consulta: " + name + " - " + pt)}`, "_blank");
        };
    </script>
</body>
</html>
