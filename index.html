<!DOCTYPE html>
<html lang="pt-br" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Portal Galv√£o Drones | Gest√£o Especializada DJI</title>
    <link rel="icon" href="https://imgur.com/ny5U9KV.png" type="image/png">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        'brand-orange': '#EF7E13',
                        'brand-green': '#0E5847',
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    }
                }
            }
        }
    </script>
    <style>
        body { -webkit-tap-highlight-color: transparent; }
        .fade-in { animation: fadeIn 0.3s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .glass-card { background: rgba(255, 255, 255, 0.98); backdrop-filter: blur(12px); }
        .dark .glass-card { background: rgba(24, 24, 27, 0.98); }
        .profile-avatar-div { background-size: cover !important; background-position: center !important; }
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        #sidebar-overlay { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.6); z-index: 35; backdrop-filter: blur(2px); }
        .sidebar-link.active { background-color: #EF7E13; color: white !important; box-shadow: 0 4px 15px rgba(239, 126, 19, 0.25); }
        .vendedor-option input:checked + div { border-color: #EF7E13; background-color: rgba(239, 126, 19, 0.08); }
        .keypad-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; }
        .key-btn { height: 64px; display: flex; align-items: center; justify-content: center; font-size: 1.5rem; font-weight: 800; border-radius: 1.25rem; background: #f3f4f6; transition: all 0.15s; color: #1f2937; user-select: none; box-shadow: 0 2px 0 rgba(0,0,0,0.05); touch-action: manipulation; }
        .dark .key-btn { background: #27272a; color: white; border: 1px solid rgba(255,255,255,0.05); }
        .key-btn:active { transform: scale(0.95); background: #EF7E13; color: white; border-color: #EF7E13; }
        .badge-seminovo { background-color: #dbeafe; color: #1e40af; }
        .badge-openbox { background-color: #fce7f3; color: #be185d; }
        .badge-revisado { background-color: #d1fae5; color: #065f46; }
        .card-image-transition { transition: background-image 0.5s ease-in-out; }
    </style>
</head>
<body class="bg-gray-100 dark:bg-black transition-colors duration-300 text-slate-900 dark:text-zinc-100 overflow-x-hidden font-sans antialiased">

    <div id="sidebar-overlay" onclick="UI.closeSidebar()"></div>

    <!-- VIEW: LOGIN -->
    <div id="login-view" class="flex items-center justify-center min-h-screen px-4 bg-gradient-to-br from-brand-green to-zinc-950">
        <div id="login-card" class="w-full max-w-md p-8 glass-card rounded-[2.5rem] shadow-2xl border border-white/20 dark:border-white/5 animate-fade-in">
            <div class="text-center mb-8">
                <img id="login-logo-trigger" src="https://imgur.com/2PNy5CS.png" alt="Logo Galv√£o Drones" class="mx-auto mb-5 h-20 w-auto drop-shadow-2xl select-none cursor-pointer active:scale-95 transition-transform">
                <h1 class="text-2xl font-black text-brand-green dark:text-white uppercase tracking-tighter italic">Portal Galv√£o Drones</h1>
                <p class="mt-1 text-sm text-gray-600 dark:text-gray-400 font-medium tracking-wide">Gest√£o T√©cnica & Comercial DJI</p>
            </div>
            <form onsubmit="Actions.login(event)" class="space-y-5">
                <div>
                    <label class="block text-[10px] font-black uppercase tracking-widest text-gray-500 dark:text-gray-400 mb-2 pl-1">Acesso</label>
                    <input type="text" id="username-input" required class="w-full rounded-2xl border-0 bg-gray-100 dark:bg-zinc-800/80 px-5 py-4 text-slate-900 dark:text-white focus:ring-2 focus:ring-brand-orange transition-all placeholder-gray-400" placeholder="Usu√°rio">
                </div>
                <div>
                    <label class="block text-[10px] font-black uppercase tracking-widest text-gray-500 dark:text-gray-400 mb-2 pl-1">Credencial</label>
                    <div class="relative">
                        <input type="password" id="password-input" required class="w-full rounded-2xl border-0 bg-gray-100 dark:bg-zinc-800/80 px-5 py-4 text-slate-900 dark:text-white focus:ring-2 focus:ring-brand-orange transition-all placeholder-gray-400" placeholder="Senha">
                        <button type="button" onclick="UI.togglePassword()" class="absolute right-5 top-1/2 -translate-y-1/2 text-gray-400 hover:text-brand-orange transition-colors p-2">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" /><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" /></svg>
                        </button>
                    </div>
                </div>
                <div class="flex items-center gap-3 px-1">
                    <input type="checkbox" id="remember-me" class="w-5 h-5 rounded border-gray-300 text-brand-orange focus:ring-brand-orange cursor-pointer">
                    <label for="remember-me" class="text-xs font-bold text-gray-600 dark:text-gray-400 uppercase tracking-wide cursor-pointer select-none">Manter conectado</label>
                </div>
                <div class="space-y-3 pt-2">
                    <button type="submit" id="btn-login-submit" class="w-full py-4 bg-brand-green hover:bg-emerald-900 text-white font-black rounded-2xl shadow-lg shadow-emerald-900/20 transition-all active:scale-[0.98] uppercase text-xs tracking-widest">Entrar no Sistema</button>
                    <button type="button" onclick="Actions.loginVisitor()" class="w-full py-4 bg-gray-100 hover:bg-gray-200 dark:bg-zinc-800 dark:hover:bg-zinc-700 text-gray-600 dark:text-gray-300 font-bold rounded-2xl transition-all uppercase text-[10px] tracking-widest">Acesso Visitante</button>
                </div>
            </form>
            <div id="error-message" class="hidden mt-4 p-3 bg-red-100 text-red-700 text-xs rounded-lg text-center font-bold"></div>
        </div>
    </div>

    <!-- VIEW: DASHBOARD -->
    <div id="dashboard-view" class="hidden flex h-screen overflow-hidden bg-gray-50 dark:bg-black">
        <!-- SIDEBAR -->
        <aside id="sidebar-menu" class="fixed inset-y-0 left-0 w-72 bg-white dark:bg-zinc-900 shadow-2xl transform -translate-x-full lg:relative lg:translate-x-0 transition-transform duration-300 z-40 flex flex-col border-r border-gray-100 dark:border-zinc-800">
            <div class="p-8 border-b border-gray-100 dark:border-zinc-800 flex flex-col items-center">
                <a href="#" onclick="UI.navigate('perfil')" id="sidebar-profile-header" class="flex flex-col items-center gap-4 group cursor-pointer w-full">
                    <div id="sidebar-profile-picture" class="w-24 h-24 rounded-full bg-brand-orange text-white flex items-center justify-center font-bold text-3xl border-4 border-gray-50 dark:border-zinc-800 shadow-xl profile-avatar-div overflow-hidden transition-transform group-hover:scale-105">
                        <span id="sidebar-profile-placeholder">?</span>
                    </div>
                    <div class="text-center w-full">
                        <p id="sidebar-user-name" class="font-black text-sm text-slate-800 dark:text-white truncate uppercase italic"></p>
                        <p id="sidebar-user-role" class="text-[10px] text-brand-green font-bold uppercase tracking-widest mt-1"></p>
                    </div>
                </a>
            </div>

            <nav class="flex-1 px-4 py-6 space-y-2 overflow-y-auto hide-scrollbar">
                <button onclick="UI.navigate('dashboard')" class="sidebar-link active flex items-center w-full px-6 py-4 rounded-2xl font-bold transition-all text-sm uppercase tracking-tighter italic text-left">Dashboard</button>
                <button onclick="UI.navigate('consultas')" class="sidebar-link flex items-center w-full px-6 py-4 rounded-2xl font-bold transition-all text-sm uppercase tracking-tighter italic text-left">Cat√°logo DJI</button>
                <button onclick="UI.navigate('usados')" class="sidebar-link flex items-center w-full px-6 py-4 rounded-2xl font-bold transition-all text-sm uppercase tracking-tighter italic text-left">Seminovos / Usados</button>
                <button onclick="UI.navigate('marketing')" id="sidebar-marketing-link" class="sidebar-link flex items-center w-full px-6 py-4 rounded-2xl font-bold transition-all text-sm uppercase tracking-tighter italic text-left">Marketing</button>
                
                <div class="pt-6 mt-2 border-t border-gray-100 dark:border-zinc-800 space-y-2">
                    <button onclick="Admin.showLogin()" id="admin-link" class="sidebar-link hidden flex items-center w-full px-6 py-4 rounded-2xl font-bold text-red-500 transition-all text-sm uppercase tracking-tighter italic text-left">
                        <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 00-1.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 001.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path></svg>
                        Administra√ß√£o
                    </button>
                    <button onclick="UI.navigate('perfil')" id="sidebar-perfil-link" class="sidebar-link flex items-center w-full px-6 py-4 rounded-2xl font-bold transition-all text-sm uppercase tracking-tighter italic text-slate-500 dark:text-zinc-400 text-left">Meu Perfil</button>
                    <button onclick="UI.navigate('sobre')" id="sobre-link" class="sidebar-link flex items-center w-full px-6 py-4 rounded-2xl font-bold transition-all text-sm uppercase tracking-tighter italic text-slate-400 dark:text-zinc-500 text-left">Sobre a Empresa</button>
                </div>
            </nav>
        </aside>

        <!-- CONTENT -->
        <div class="flex-1 flex flex-col min-w-0 overflow-y-auto font-sans relative">
            <header class="h-20 bg-white/90 dark:bg-black/90 backdrop-blur-lg border-b border-gray-100 dark:border-zinc-800 px-4 sm:px-8 flex items-center justify-between sticky top-0 z-30">
                <div class="flex items-center gap-3">
                    <button onclick="UI.toggleSidebar()" class="lg:hidden p-2 bg-gray-100 dark:bg-zinc-800 rounded-xl text-gray-600 dark:text-zinc-300 active:scale-95 transition-all"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M4 6h16M4 12h16M4 18h16" stroke-width="2" stroke-linecap="round"></path></svg></button>
                    <h1 id="page-title" class="text-lg sm:text-xl font-black text-slate-800 dark:text-white uppercase italic tracking-tighter">Dashboard</h1>
                </div>
                <div class="flex items-center gap-3">
                    <button onclick="Utils.toggleTheme()" class="p-2.5 rounded-xl bg-gray-100 dark:bg-zinc-800 text-gray-500 dark:text-zinc-400 transition-all hover:bg-gray-200 dark:hover:bg-zinc-700">
                        <svg id="theme-icon" class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20"><path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"></path></svg>
                    </button>
                    <button onclick="Utils.reload()" class="px-5 py-2.5 bg-brand-orange text-white font-black rounded-xl text-[10px] uppercase shadow-lg hover:bg-orange-600 active:scale-95 transition-all tracking-widest">Sair</button>
                </div>
            </header>

            <main id="main-content" class="p-4 sm:p-8 space-y-6">
                <!-- Conte√∫do Injetado via JS -->
            </main>
        </div>
    </div>

    <!-- MODAIS E POPUPS -->

    <!-- Modal Admin Login (Keypad) -->
    <div id="admin-login-modal" class="hidden fixed inset-0 bg-black/90 backdrop-blur-md z-[120] flex items-center justify-center p-4 fade-in">
        <div class="bg-white dark:bg-zinc-900 rounded-[2.5rem] w-full max-w-sm p-8 shadow-2xl border dark:border-white/10 text-center">
            <h3 class="text-xl font-black text-brand-green dark:text-white uppercase italic tracking-tighter mb-2">Acesso Restrito</h3>
            <p class="text-[9px] text-gray-400 uppercase tracking-widest mb-6">Digite a senha administrativa</p>
            <div id="keypad-display" class="w-full h-16 mb-8 flex items-center justify-center bg-gray-50 dark:bg-zinc-800 rounded-2xl text-3xl font-black tracking-[1rem] text-brand-orange h-20"></div>
            <div id="virtual-keypad" class="keypad-grid mb-8"></div>
            <div class="grid grid-cols-2 gap-3">
                <button onclick="Admin.clearPass()" class="py-4 bg-red-100 dark:bg-red-900/20 text-red-600 rounded-2xl font-black uppercase text-[10px] tracking-widest">Limpar</button>
                <button onclick="UI.closeModal('admin-login-modal')" class="py-4 bg-gray-100 dark:bg-zinc-800 text-gray-500 rounded-2xl font-black uppercase text-[10px] tracking-widest">Cancelar</button>
            </div>
        </div>
    </div>

    <!-- Calculadora Pop-up -->
    <div id="calculator-popup" class="hidden fixed bottom-24 right-6 w-80 sm:w-96 glass-card rounded-[2rem] shadow-2xl border dark:border-zinc-700 p-6 z-50 transition-all duration-300 transform origin-bottom-right">
        <div class="flex justify-between items-center mb-6"><h3 class="font-black text-brand-green dark:text-white uppercase italic text-xl tracking-tighter">Simulador Galv√£o</h3><button onclick="UI.toggleCalculator()" class="text-gray-400 text-2xl hover:text-red-500">√ó</button></div>
        <div class="space-y-4">
            <input type="number" id="popup-sale-value" step="0.01" placeholder="Valor Base (R$)" class="w-full px-4 py-3 bg-gray-50 dark:bg-zinc-800 rounded-xl focus:ring-2 focus:ring-brand-orange outline-none font-bold text-slate-800 dark:text-white">
            <select id="popup-installments" class="w-full px-4 py-3 bg-gray-50 dark:bg-zinc-800 rounded-xl outline-none font-bold text-sm text-slate-800 dark:text-white">
                <option value="0">Selecionar parcelas...</option>
            </select>
            <div id="popup-calculator-results" class="hidden p-4 rounded-2xl bg-brand-green/5 space-y-2 border border-brand-green/10">
                <div class="flex justify-between text-xs font-black italic uppercase"><span class="text-slate-600 dark:text-zinc-400">Total c/ Taxas:</span><span id="popup-total-value" class="dark:text-white"></span></div>
                <div class="flex justify-between items-center text-brand-orange pt-2"><span class="text-xs font-black uppercase tracking-tighter">Parcela:</span><span id="popup-installment-value" class="text-xl font-black italic tracking-tighter dark:text-white"></span></div>
            </div>
            <button onclick="Actions.shareCalc()" class="w-full py-4 bg-green-500 hover:bg-green-600 text-white font-black rounded-2xl transition-all shadow-md uppercase text-[10px] tracking-widest active:scale-95">WhatsApp</button>
        </div>
    </div>
    <button id="calculator-fab" onclick="UI.toggleCalculator()" class="hidden fixed bottom-6 right-6 w-16 h-16 bg-brand-orange text-white rounded-full shadow-2xl flex items-center justify-center z-50 transition-all hover:scale-110 active:scale-90"><svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z" stroke-width="2"></path></svg></button>

    <!-- Modal Detalhes Usados -->
    <div id="used-details-modal" class="hidden fixed inset-0 bg-black/80 backdrop-blur-md z-[110] flex items-center justify-center p-4 fade-in">
        <div class="bg-white dark:bg-zinc-900 rounded-[2.5rem] w-full max-w-4xl p-6 sm:p-8 shadow-2xl border dark:border-white/10 flex flex-col md:flex-row gap-8 max-h-[90vh] overflow-y-auto">
            <div class="w-full md:w-1/2 space-y-4">
                <div id="modal-used-main-img" class="w-full h-64 sm:h-80 bg-gray-50 dark:bg-zinc-800 rounded-3xl bg-cover bg-center shadow-inner"></div>
                <div id="modal-used-thumbnails" class="flex gap-2 overflow-x-auto hide-scrollbar"></div>
            </div>
            <div class="w-full md:w-1/2 flex flex-col">
                <div class="flex justify-between items-start mb-2">
                    <span id="modal-used-badge" class="px-3 py-1 rounded-full text-[10px] font-black uppercase tracking-widest"></span>
                    <button onclick="UI.closeModal('used-details-modal')" class="text-2xl text-gray-400 hover:text-red-500">√ó</button>
                </div>
                <h3 id="modal-used-title" class="text-3xl font-black text-slate-800 dark:text-white uppercase italic tracking-tighter mb-4 leading-none"></h3>
                <div class="bg-gray-50 dark:bg-zinc-800/50 p-4 rounded-2xl mb-6">
                    <h4 class="text-[10px] font-bold text-gray-500 dark:text-gray-400 uppercase tracking-widest mb-3">Sa√∫de das Baterias (Ciclos)</h4>
                    <div id="modal-used-batteries" class="flex flex-wrap gap-3"></div>
                </div>
                <p id="modal-used-price" class="text-3xl font-black text-brand-orange italic tracking-tighter leading-none mb-6"></p>
                <button onclick="Actions.consultUsed()" class="w-full py-5 bg-brand-green text-white rounded-2xl font-black uppercase text-[10px] tracking-widest shadow-lg active:scale-95 transition-all">Consultar Disponibilidade</button>
            </div>
        </div>
    </div>

    <!-- Modal Bypass (T√©cnico) -->
    <div id="bypass-login-modal" class="hidden fixed inset-0 bg-black/95 backdrop-blur-xl z-[130] flex items-center justify-center p-4 fade-in">
        <div class="bg-white dark:bg-zinc-900 rounded-[2.5rem] w-full max-w-sm p-8 shadow-2xl border-2 border-brand-orange text-center">
             <div class="mb-4"><div class="w-16 h-16 bg-brand-orange rounded-full flex items-center justify-center mx-auto"><svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path></svg></div></div>
             <h3 class="text-xl font-black text-brand-orange uppercase italic tracking-tighter mb-2">Acesso T√©cnico</h3>
             <div id="bypass-keypad-display" class="w-full h-16 mb-8 flex items-center justify-center bg-gray-100 dark:bg-zinc-800 rounded-2xl text-3xl font-black tracking-[1rem] text-brand-orange"></div>
             <div id="bypass-virtual-keypad" class="keypad-grid mb-8"></div>
             <button onclick="UI.closeModal('bypass-login-modal')" class="w-full py-4 bg-gray-100 dark:bg-zinc-800 text-gray-500 rounded-2xl font-black uppercase text-[10px] tracking-widest">Cancelar</button>
        </div>
    </div>

    <script>
        const CONFIG = {
            central: "6236360668",
            installmentRates: { 1: 0, 2: 3, 3: 4.5, 4: 6, 5: 7.5, 6: 9, 10: 12, 12: 15 },
            adminPIN: "2025"
        };

        const STATE = {
            products: [
                { name: "DJI Mini 4 Pro (RC 2)", sell: "R$ 9.800,00", line: "Consumer" },
                { name: "DJI Mavic 3 Pro Fly More", sell: "R$ 24.500,00", line: "Consumer" },
                { name: "DJI Avata 2 Explorer", sell: "R$ 11.200,00", line: "FPV" },
                { name: "DJI Air 3 (RC 2)", sell: "R$ 13.400,00", line: "Consumer" }
            ],
            usedProducts: [
                { 
                    name: "DJI Mini 3 Pro Seminovo", 
                    price: "R$ 5.900,00", 
                    condition: "Seminovo", 
                    images: ["https://imgur.com/2PNy5CS.png", "https://imgur.com/ny5U9KV.png"],
                    desc: "Estado de novo, apenas 5 voos.",
                    details: { batteries: [3, 4], propellers: "Originais", bag: true, hub: true, cables: true }
                }
            ],
            marketingAssets: [
                { title: "Manual Mavic 3", type: "PDF", preview: "https://imgur.com/2PNy5CS.png" },
                { title: "Tabela 2024", type: "Tabela", preview: "https://imgur.com/ny5U9KV.png" }
            ],
            users: [
                { name: "Mikhaell Galv√£o", role: "Administrador", username: "admin", password: "123", avatar: "https://imgur.com/ny5U9KV.png" }
            ],
            currentUser: null,
            adminSession: false,
            adminPassBuffer: "",
            bypassPassBuffer: "",
            intervals: []
        };

        const Utils = {
            fmtBRL: new Intl.NumberFormat("pt-BR", { style: "currency", currency: "BRL" }),
            cleanCurrency: (val) => {
                if(typeof val === 'number') return val;
                return parseFloat(val.replace(/[R$\.\s]/g, '').replace(',', '.')) || 0;
            },
            toggleTheme: () => document.documentElement.classList.toggle('dark'),
            reload: () => location.reload()
        };

        const UI = {
            init: () => {
                const sel = document.getElementById("popup-installments");
                for (let i in CONFIG.installmentRates) { 
                    const opt = document.createElement("option"); 
                    opt.value = i; 
                    opt.textContent = `${i}x (+${CONFIG.installmentRates[i]}%)`; 
                    sel.appendChild(opt); 
                }
                Bypass.init();
            },
            showError: (msg) => {
                const el = document.getElementById('error-message');
                el.textContent = msg; el.classList.remove('hidden');
                setTimeout(() => el.classList.add('hidden'), 3000);
            },
            togglePassword: () => {
                const i = document.getElementById('password-input');
                i.type = i.type === 'password' ? 'text' : 'password';
            },
            navigate: (pageId) => {
                if (pageId === 'admin' && !STATE.adminSession) { Admin.showLogin(); return; }
                
                const content = document.getElementById('main-content');
                content.innerHTML = '';
                document.getElementById('page-title').textContent = pageId.toUpperCase();
                
                STATE.intervals.forEach(clearInterval); STATE.intervals = [];

                switch(pageId) {
                    case 'dashboard': UI.renderDashboard(); break;
                    case 'consultas': UI.renderCatalog(); break;
                    case 'usados': UI.renderUsed(); break;
                    case 'marketing': UI.renderMarketing(); break;
                    case 'perfil': UI.renderProfile(); break;
                    case 'sobre': UI.renderAbout(); break;
                }

                document.querySelectorAll('.sidebar-link').forEach(l => l.classList.remove('active'));
                const activeBtn = document.querySelector(`button[onclick="UI.navigate('${pageId}')"]`);
                if(activeBtn) activeBtn.classList.add('active');
                UI.closeSidebar();
            },
            renderDashboard: () => {
                document.getElementById('main-content').innerHTML = `
                    <div class="bg-white dark:bg-zinc-900 p-8 rounded-[2.5rem] shadow-sm border dark:border-zinc-800 fade-in">
                        <h2 class="text-3xl font-black italic tracking-tighter text-slate-800 dark:text-white uppercase">Ol√°, <span class="text-brand-orange">${STATE.currentUser.name.split(' ')[0]}</span>!</h2>
                        <p class="text-gray-500 mt-2 font-bold uppercase tracking-widest text-[10px]">Unidade Goi√¢nia | ${STATE.currentUser.role}</p>
                    </div>
                    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 pt-6">
                        ${UI.cardBtn('consultas', 'bg-emerald-50 text-brand-green', 'Cat√°logo DJI', 'M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z')}
                        ${UI.cardBtn('usados', 'bg-blue-50 text-blue-600', 'Seminovos', 'M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15')}
                    </div>
                `;
            },
            cardBtn: (page, color, text, icon) => `
                <button onclick="UI.navigate('${page}')" class="p-8 bg-white dark:bg-zinc-900 rounded-[2.5rem] border dark:border-zinc-800 hover:shadow-xl transition-all flex flex-col items-center group active:scale-95 w-full">
                    <div class="p-5 rounded-3xl mb-4 ${color} dark:bg-opacity-10"><svg class="w-10 h-10" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="${icon}" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path></svg></div>
                    <span class="font-black uppercase text-xs dark:text-white tracking-widest italic">${text}</span>
                </button>
            `,
            renderCatalog: () => {
                let html = `<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 fade-in">`;
                html += STATE.products.map(p => `
                    <div class="bg-white dark:bg-zinc-900 p-6 rounded-[2.5rem] border dark:border-zinc-800 shadow-sm text-left">
                        <h3 class="font-black text-brand-green dark:text-white uppercase italic text-sm">${p.name}</h3>
                        <p class="text-[10px] text-gray-500 uppercase font-bold tracking-widest">${p.line}</p>
                        <div class="mt-4 pt-4 border-t dark:border-zinc-800">
                            <p class="text-[8px] font-black text-gray-500 uppercase tracking-widest">Valor DJI</p>
                            <p class="text-2xl font-black text-brand-green dark:text-white italic tracking-tighter">${p.sell}</p>
                        </div>
                        <button onclick="Actions.openShareModal('${p.name}', '${p.sell}')" class="w-full mt-4 bg-brand-green text-white py-4 rounded-2xl font-black uppercase text-[10px] tracking-widest">Compartilhar Card</button>
                    </div>
                `).join('');
                html += `</div>`;
                document.getElementById('main-content').innerHTML = html;
            },
            renderUsed: () => {
                let html = `<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 fade-in">`;
                html += STATE.usedProducts.map((p, idx) => `
                    <div class="bg-white dark:bg-zinc-900 p-6 rounded-[2.5rem] border dark:border-zinc-800 shadow-sm text-left group" onclick="Actions.openUsedDetails(${idx})">
                        <span class="px-3 py-1 rounded-full text-[9px] font-black uppercase bg-blue-100 text-blue-700">${p.condition}</span>
                        <h3 class="font-black text-slate-800 dark:text-white uppercase italic text-lg mt-2">${p.name}</h3>
                        <div id="card-img-${idx}" class="w-full h-40 bg-gray-100 dark:bg-zinc-800 rounded-xl my-4 bg-cover bg-center transition-all" style="background-image: url('${p.images[0]}')"></div>
                        <p class="text-2xl font-black text-brand-orange italic tracking-tighter">${p.price}</p>
                        <button class="w-full mt-4 bg-brand-green text-white py-4 rounded-2xl font-black uppercase text-[10px] tracking-widest">Ver Detalhes</button>
                    </div>
                `).join('');
                html += `</div>`;
                document.getElementById('main-content').innerHTML = html;
                Actions.startCarousels();
            },
            renderProfile: () => {
                const u = STATE.currentUser;
                document.getElementById('main-content').innerHTML = `
                    <div class="bg-white dark:bg-zinc-900 p-10 rounded-[2.5rem] border dark:border-zinc-800 text-center fade-in">
                        <div class="w-32 h-32 mx-auto rounded-full border-4 border-brand-orange shadow-xl profile-avatar-div mb-6" style="background-image: url('${u.avatar}')"></div>
                        <h2 class="text-2xl font-black dark:text-white uppercase italic">${u.name}</h2>
                        <p class="text-brand-orange font-bold uppercase text-[10px] tracking-widest">${u.role}</p>
                        <div class="mt-8 flex flex-col items-center">
                            <img id="profile-qrcode" class="w-32 h-32 rounded-xl border p-2 bg-white">
                            <p class="mt-2 text-[10px] font-bold text-gray-500 uppercase tracking-widest">Aponte a c√¢mera para salvar o contato</p>
                        </div>
                    </div>
                `;
                setTimeout(() => Actions.genQRCode(), 100);
            },
            renderAbout: () => {
                document.getElementById('main-content').innerHTML = `
                    <div class="bg-white dark:bg-zinc-900 p-10 rounded-[2.5rem] border dark:border-zinc-800 text-center space-y-6 fade-in">
                        <img src="https://imgur.com/2PNy5CS.png" class="h-24 mx-auto mb-4" alt="Logo">
                        <h2 class="text-3xl font-black text-brand-green uppercase italic tracking-tighter">Galv√£o Drones | Goi√¢nia</h2>
                        <p class="text-gray-600 dark:text-gray-400 italic font-medium">Lideran√ßa em manuten√ß√£o t√©cnica e vendas DJI no Centro-Oeste.</p>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-left">
                            <div class="p-6 bg-gray-50 dark:bg-zinc-800 rounded-2xl">
                                <h4 class="font-black text-brand-orange uppercase text-xs mb-2">Comercial</h4>
                                <p class="text-sm">CNPJ: 60.102.179/0001-10</p>
                                <p class="text-sm">WhatsApp: (62) 3636-0668</p>
                            </div>
                            <div class="p-6 bg-gray-50 dark:bg-zinc-800 rounded-2xl">
                                <h4 class="font-black text-brand-orange uppercase text-xs mb-2">Social</h4>
                                <p class="text-sm">Instagram: @galvaodrones</p>
                                <p class="text-sm">Site: www.galvaodrones.com.br</p>
                            </div>
                        </div>
                    </div>
                `;
            },
            renderMarketing: () => {
                let html = `<div class="grid grid-cols-2 md:grid-cols-4 gap-4 fade-in">`;
                html += STATE.marketingAssets.map(m => `
                    <div class="bg-white dark:bg-zinc-900 p-4 rounded-[2rem] border dark:border-zinc-800 flex flex-col items-center text-center">
                        <div class="w-20 h-20 mb-3 rounded-full bg-gray-50 dark:bg-zinc-800 flex items-center justify-center overflow-hidden">
                            <img src="${m.preview}" class="w-full h-full object-cover">
                        </div>
                        <h4 class="font-bold text-xs uppercase dark:text-white leading-tight">${m.title}</h4>
                        <p class="text-[9px] text-gray-500 uppercase tracking-widest mt-1">${m.type}</p>
                        <button class="w-full mt-3 py-2 bg-brand-orange/10 text-brand-orange rounded-xl font-bold text-[9px] uppercase tracking-widest">Baixar</button>
                    </div>
                `).join('');
                html += `</div>`;
                document.getElementById('main-content').innerHTML = html;
            },
            toggleCalculator: () => document.getElementById('calculator-popup').classList.toggle('hidden'),
            toggleSidebar: () => { document.getElementById('sidebar-menu').classList.remove('-translate-x-full'); document.getElementById('sidebar-overlay').style.display = 'block'; },
            closeSidebar: () => { document.getElementById('sidebar-menu').classList.add('-translate-x-full'); document.getElementById('sidebar-overlay').style.display = 'none'; },
            closeModal: (id) => document.getElementById(id).classList.add('hidden'),
            openModal: (id) => document.getElementById(id).classList.remove('hidden')
        };

        const Actions = {
            login: (e) => {
                e.preventDefault();
                const u = document.getElementById('username-input').value;
                const p = document.getElementById('password-input').value;
                const user = STATE.users.find(x => x.username === u && x.password === p);
                if(user) Actions.setupSession(user);
                else UI.showError("Credenciais Inv√°lidas");
            },
            loginVisitor: () => {
                Actions.setupSession({ name: "Visitante", role: "Visitante", username: "guest", avatar: "" });
            },
            setupSession: (user) => {
                STATE.currentUser = user;
                document.getElementById('login-view').classList.add('hidden');
                document.getElementById('dashboard-view').classList.remove('hidden');
                document.getElementById('calculator-fab').classList.remove('hidden');
                document.getElementById('sidebar-user-name').textContent = user.name;
                document.getElementById('sidebar-user-role').textContent = user.role;
                
                const adminBtn = document.getElementById('admin-link');
                if(user.role === 'Administrador' || user.role === 'T√©cnico') adminBtn.classList.remove('hidden');
                
                const sbPic = document.getElementById('sidebar-profile-picture');
                if(user.avatar) {
                    sbPic.style.backgroundImage = `url('${user.avatar}')`;
                    document.getElementById('sidebar-profile-placeholder').style.display = 'none';
                } else {
                    document.getElementById('sidebar-profile-placeholder').textContent = user.name.charAt(0);
                }
                UI.navigate('dashboard');
            },
            startCarousels: () => {
                STATE.usedProducts.forEach((p, idx) => {
                    let currentImgIdx = 0;
                    const interval = setInterval(() => {
                        currentImgIdx = (currentImgIdx + 1) % p.images.length;
                        const el = document.getElementById(`card-img-${idx}`);
                        if(el) el.style.backgroundImage = `url('${p.images[currentImgIdx]}')`;
                    }, 3000);
                    STATE.intervals.push(interval);
                });
            },
            openUsedDetails: (idx) => {
                const p = STATE.usedProducts[idx];
                const mainImg = document.getElementById('modal-used-main-img');
                mainImg.style.backgroundImage = `url('${p.images[0]}')`;
                
                const thumbs = document.getElementById('modal-used-thumbnails');
                thumbs.innerHTML = p.images.map(img => `
                    <div class="w-16 h-16 rounded-xl bg-cover bg-center cursor-pointer border-2 border-transparent hover:border-brand-orange" 
                         style="background-image: url('${img}')" 
                         onclick="document.getElementById('modal-used-main-img').style.backgroundImage = 'url(\\'${img}\\')'"></div>
                `).join('');

                document.getElementById('modal-used-title').textContent = p.name;
                document.getElementById('modal-used-price').textContent = p.price;
                document.getElementById('modal-used-badge').textContent = p.condition;
                
                const batDiv = document.getElementById('modal-used-batteries');
                batDiv.innerHTML = p.details.batteries.map((c, i) => `
                    <div class="px-4 py-2 bg-gray-100 dark:bg-zinc-800 rounded-xl text-center">
                        <p class="text-[8px] font-bold text-gray-400">Bat ${i+1}</p>
                        <p class="font-black text-sm dark:text-white">${c}</p>
                    </div>
                `).join('');
                UI.openModal('used-details-modal');
            },
            consultUsed: () => {
                const name = document.getElementById('modal-used-title').textContent;
                window.open(`https://wa.me/55${CONFIG.central}?text=${encodeURIComponent("Ol√° Galv√£o, tenho interesse no " + name + " seminovo.")}`, '_blank');
            },
            genQRCode: () => {
                const u = STATE.currentUser;
                const vCard = `BEGIN:VCARD\nFN:${u.name}\nTEL:${CONFIG.central}\nORG:Galv√£o Drones\nEND:VCARD`;
                document.getElementById('profile-qrcode').src = `https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=${encodeURIComponent(vCard)}`;
            },
            shareCalc: () => {
                const total = document.getElementById('popup-total-value').textContent;
                const inst = document.getElementById('popup-installment-value').textContent;
                const msg = `üöÄ *Simula√ß√£o Galv√£o Drones*\n\nTotal: ${total}\nCondi√ß√£o: ${inst}`;
                window.open(`https://wa.me/?text=${encodeURIComponent(msg)}`, '_blank');
            }
        };

        const Admin = {
            showLogin: () => {
                STATE.adminPassBuffer = "";
                document.getElementById('keypad-display').textContent = "";
                const vk = document.getElementById('virtual-keypad');
                vk.innerHTML = '';
                [1,2,3,4,5,6,7,8,9,0].forEach(n => {
                    const b = document.createElement('button');
                    b.className = 'key-btn'; b.textContent = n;
                    b.onclick = () => Admin.handleKey(n);
                    vk.appendChild(b);
                });
                UI.openModal('admin-login-modal');
            },
            handleKey: (n) => {
                if(STATE.adminPassBuffer.length < 4) {
                    STATE.adminPassBuffer += n;
                    document.getElementById('keypad-display').textContent = "‚Ä¢".repeat(STATE.adminPassBuffer.length);
                    if(STATE.adminPassBuffer.length === 4) {
                        setTimeout(() => {
                            if(STATE.adminPassBuffer === CONFIG.adminPIN) {
                                STATE.adminSession = true;
                                UI.closeModal('admin-login-modal');
                                UI.navigate('dashboard');
                                UI.showError("Acesso Admin Liberado");
                            } else {
                                Admin.clearPass();
                                UI.showError("PIN Incorreto");
                            }
                        }, 200);
                    }
                }
            },
            clearPass: () => {
                STATE.adminPassBuffer = "";
                document.getElementById('keypad-display').textContent = "";
            }
        };

        const Bypass = {
            clicks: 0,
            timer: null,
            init: () => {
                const logo = document.getElementById('login-logo-trigger');
                logo.onclick = () => {
                    clearTimeout(Bypass.timer); Bypass.clicks++;
                    if(Bypass.clicks >= 5) {
                        Bypass.clicks = 0; Bypass.showModal();
                    }
                    Bypass.timer = setTimeout(() => Bypass.clicks = 0, 1500);
                };
            },
            showModal: () => {
                STATE.bypassPassBuffer = "";
                document.getElementById('bypass-keypad-display').textContent = "";
                const vk = document.getElementById('bypass-virtual-keypad');
                vk.innerHTML = '';
                [1,2,3,4,5,6,7,8,9,0].forEach(n => {
                    const b = document.createElement('button');
                    b.className = 'key-btn'; b.textContent = n;
                    b.onclick = () => Bypass.handleKey(n);
                    vk.appendChild(b);
                });
                UI.openModal('bypass-login-modal');
            },
            handleKey: (n) => {
                STATE.bypassPassBuffer += n;
                document.getElementById('bypass-keypad-display').textContent = "‚Ä¢".repeat(STATE.bypassPassBuffer.length);
                if(STATE.bypassPassBuffer === "0639") { // PIN de exemplo
                    UI.closeModal('bypass-login-modal');
                    Actions.setupSession({ name: "T√©cnico Galv√£o", role: "T√©cnico", username: "tech", avatar: "https://imgur.com/ny5U9KV.png" });
                } else if(STATE.bypassPassBuffer.length >= 4) {
                    STATE.bypassPassBuffer = "";
                    document.getElementById('bypass-keypad-display').textContent = "";
                }
            }
        };

        document.addEventListener('DOMContentLoaded', () => {
            UI.init();
            
            // L√≥gica Real-time Calculadora
            const saleInput = document.getElementById('popup-sale-value');
            const instSelect = document.getElementById('popup-installments');
            const calcUpdate = () => {
                const val = parseFloat(saleInput.value) || 0;
                const inst = parseInt(instSelect.value) || 0;
                if(val > 0 && inst > 0) {
                    const total = val * (1 + (CONFIG.installmentRates[inst] || 0) / 100);
                    document.getElementById('popup-total-value').textContent = Utils.fmtBRL.format(total);
                    document.getElementById('popup-installment-value').textContent = `${inst}x de ${Utils.fmtBRL.format(total/inst)}`;
                    document.getElementById('popup-calculator-results').classList.remove('hidden');
                }
            };
            saleInput.oninput = calcUpdate;
            instSelect.onchange = calcUpdate;
        });
    </script>
</body>
</html>
